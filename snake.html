<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: black;
        }
    </style>
</head>

<body>
    <canvas id="mainCanvas" width="800" height="800">
</body>

<script>
    "use strict";
    let ctx = document.getElementById('mainCanvas').getContext('2d');
    let apple = [], //apple cordinate
        hdg = [0, 1], //vector
        sLength = 2, //body, exclude head
        sBody = []; //array of body

    //init
    sBody.push([1, 6]);
    sBody.push([1, 5]);
    sBody.push([1, 4]);
    let turn = false;

    document.addEventListener('keydown', function(e) {
        let n = 0;
        if (e.key == 'w' || e.key == 'ArrowUp') n = [0, -1];
        if (e.key == 'd' || e.key == 'ArrowRight') n = [1, 0];
        if (e.key == 's' || e.key == 'ArrowDown') n = [0, 1];
        if (e.key == 'a' || e.key == 'ArrowLeft') n = [-1, 0];
        if (n == 0) return;
        if (hdg[0] * n[0] != -1 && hdg[1] * n[1] != -1) {
            hdg[0] = n[0];
            hdg[1] = n[1];
        }
        turn = true;
    })

    function drawCanvas() {
        ctx.clearRect(0, 0, 800, 800)

        ctx.fillStyle = "rgb(255,0,0)";
        ctx.fillRect(apple[0] * 40, apple[1] * 40, 40, 40)

        ctx.fillStyle = "rgb(0,255,255)";
        ctx.fillRect(sBody[0][0] * 40, sBody[0][1] * 40, 40, 40)
        for (let l1 = 1; l1 < sBody.length; l1++) {
            ctx.fillStyle = "rgb(0,255,0)";
            ctx.fillRect(sBody[l1][0] * 40, sBody[l1][1] * 40, 40, 40)
        }
    }

    function makeApple() {
        let x = Math.floor(Math.random() * 10) * 2,
            y = Math.floor(Math.random() * 10) * 2;
        let l1;
        for (l1 in sBody)
            if (sBody[l1][0] == x && sBody[l1][1] == y) {
                makeApple(); //recursive recall
                return;
            }
        //update apple
        apple[0] = x;
        apple[1] = y;
    }
    makeApple();
    let doneInit = true;

    var moveSnake = setInterval(() => {
        if (!doneInit) return

        let hcur = [sBody[0][0], sBody[0][1]]; //head
        let l1; //counter

        //update head position
        let tBody = [
            [hcur[0] + hdg[0], hcur[1] + hdg[1]]
        ];
        for (l1 = 1; l1 < sBody.length; l1++) //loop through body, a[n-1]=a[n1]
            tBody.push([sBody[l1 - 1][0], sBody[l1 - 1][1]]);

        //colision
        let nHead = [hcur[0] + hdg[0], hcur[1] + hdg[1]];
        console.log(nHead)
        if (nHead[0] == apple[0] && nHead[1] == apple[1]) { //if ate apple
            tBody.push([sBody[sBody.length - 1][0], sBody[sBody.length - 1][1]]);
            makeApple(); //new apple
        }
        for (l1 in tBody) { //clear interval
            l1 = parseInt(l1) + 1;
            if (l1 == tBody.length) break; //avoid colision with head
            if (tBody[l1][0] == nHead[0] && tBody[l1][1] == nHead[1])
                clearInterval(moveSnake);
        }

        sBody = [];
        for (l1 = 0; l1 < tBody.length; l1++)
            sBody.push(tBody[l1])

        drawCanvas()
    }, 500);
</script>

</html>